{% extends 'base.html' %}

{% block title %}Registration Requests - IoT Admin{% endblock %}

{% block content %}
<div class="registration-container">
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
    <div class="registration-header">
        <h1>Registration Requests</h1>
        <p>Review and approve user registration requests</p>
    </div>

    {% if requests %}
        <div class="requests-list">
            {% for req in requests %}
                <div class="request-card">
                    <div class="request-info">
                        <h3>{{ req.user.username }}</h3>
                        <p><strong>Email:</strong> {{ req.user.email|default:"Not provided" }}</p>
                        <p><strong>Requested:</strong> {{ req.created_at|date:"M d, Y H:i" }}</p>
                        <div class="request-details">
                            <p><strong>Group Request Info:</strong></p>
                            <div class="request-text">{{ req.requested_group_info }}</div>
                        </div>
                    </div>
                    
                    <div class="request-actions">
                        <form method="post" class="request-form">
                            {% csrf_token %}
                            <input type="hidden" name="request_id" value="{{ req.id }}">
                            
                            <div class="form-group">
                                <label for="group_{{ req.id }}">Assign to Group:</label>
                                <select name="group_id" id="group_{{ req.id }}" class="form-input" required>
                                    <option value="">Select a group...</option>
                                    {% for group in groups %}
                                        <option value="{{ group.id }}">{{ group.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="role_{{ req.id }}">Role:</label>
                                <select name="role" id="role_{{ req.id }}" class="form-input">
                                    <option value="member">Member</option>
                                    <option value="admin">Group Admin</option>
                                </select>
                            </div>
                            
                            <div class="request-buttons">
                                <button type="submit" name="action" value="approve" class="btn-primary">
                                    Approve
                                </button>
                                <button type="submit" name="action" value="reject" class="btn-secondary">
                                    Reject
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <h3>No pending requests</h3>
            <p>All registration requests have been processed.</p>
        </div>
    {% endif %}
</div>

<style>
.registration-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
}

.registration-header {
    background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
    border-radius: 16px;
    padding: 32px;
    margin-bottom: 32px;
    color: white;
}

.registration-header h1 {
    margin: 0 0 8px 0;
    font-size: 2rem;
    font-weight: 600;
}

.registration-header p {
    margin: 0;
    opacity: 0.9;
    font-size: 1.1rem;
}

.alert {
    padding: 12px 16px;
    border-radius: 8px;
    margin-bottom: 20px;
}

.alert-success {
    background: #d1fae5;
    color: #065f46;
    border: 1px solid #a7f3d0;
}

.alert-error {
    background: #fee2e2;
    color: #991b1b;
    border: 1px solid #fecaca;
}

.requests-list {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.request-card {
    background: #fff;
    border: 1px solid #dadce0;
    border-radius: 8px;
    padding: 24px;
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 24px;
    align-items: start;
}

.request-info h3 {
    margin: 0 0 12px 0;
    color: #202124;
}

.request-info p {
    margin: 8px 0;
    color: #5f6368;
}

.request-details {
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid #f0f0f0;
}

.request-text {
    background: #f8f9fa;
    padding: 12px;
    border-radius: 4px;
    margin-top: 8px;
    white-space: pre-wrap;
    font-family: inherit;
}

.request-actions {
    min-width: 250px;
}

.request-form .form-group {
    margin-bottom: 16px;
}

.request-form label {
    display: block;
    margin-bottom: 4px;
    font-weight: 500;
    color: #202124;
}

.form-input {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid #d1d5db;
    border-radius: 8px;
    font-size: 14px;
    background: white;
}

.btn-primary {
    background: #dc2626;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s;
}

.btn-primary:hover {
    background: #b91c1c;
}

.request-buttons {
    display: flex;
    gap: 8px;
}

.btn-secondary {
    background-color: #f8f9fa;
    color: #3c4043;
    border: 1px solid #dadce0;
    border-radius: 4px;
    padding: 8px 16px;
    cursor: pointer;
    font-family: 'Roboto', Arial, sans-serif;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.15s ease-in-out;
}

.btn-secondary:hover {
    background-color: #f1f3f4;
    border-color: #c0c0c0;
}

.empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #5f6368;
}
</style>
{% endblock %}